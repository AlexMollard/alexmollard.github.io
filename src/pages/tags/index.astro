---
import PageLayout from '../../layouts/PageLayout.astro';
import { getCollection } from 'astro:content';
const posts = await getCollection('blog', ({ data }) => !data.draft);
const tagMap = new Map<string, any[]>();
for (const p of posts) {
  for (const t of p.data.tags) {
    if (!tagMap.has(t)) tagMap.set(t, []);
    tagMap.get(t)?.push(p);
  }
}
const tags = Array.from(tagMap.entries()).sort((a,b)=> a[0].localeCompare(b[0]));
---
<PageLayout title="Tags">
  <p>Browse posts by tag.</p>
  {tags.length === 0 ? <p><em>No tags yet.</em></p> : (
    <>
      <ul class="tag-cloud">
        {tags.map(([name, list]) => (
          <li><a href={`#${name.toLowerCase()}`}>{name} ({list.length})</a></li>
        ))}
      </ul>
      {tags.map(([name, list]) => (
        <section id={name.toLowerCase()}>
          <h2>{name}</h2>
          <ul>
            {list.map(post => (
              <li><a href={`/blog/${post.slug}/`}>{post.data.title}</a> <small>{post.data.pubDate.toISOString().slice(0,10)}</small></li>
            ))}
          </ul>
        </section>
      ))}
    </>
  )}
</PageLayout>
