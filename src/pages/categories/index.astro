---
import PageLayout from '../../layouts/PageLayout.astro';
import { getCollection } from 'astro:content';
const posts = await getCollection('blog', ({ data }) => !data.draft);
const categoryMap = new Map<string, any[]>();
for (const p of posts) {
  for (const c of p.data.categories) {
    if (!categoryMap.has(c)) categoryMap.set(c, []);
    categoryMap.get(c)?.push(p);
  }
}
const categories = Array.from(categoryMap.entries()).sort((a,b)=> a[0].localeCompare(b[0]));
---
<PageLayout title="Categories">
  <p>Browse posts by category.</p>
  {categories.length === 0 ? <p><em>No categories yet.</em></p> : (
    <>
      <ul class="category-list">
        {categories.map(([name, list]) => (
          <li><a href={`#${name.toLowerCase()}`}>{name} ({list.length})</a></li>
        ))}
      </ul>
      {categories.map(([name, list]) => (
        <section id={name.toLowerCase()}>
          <h2>{name}</h2>
          <ul>
            {list.map(post => (
              <li><a href={`/blog/${post.slug}/`}>{post.data.title}</a> <small>{post.data.pubDate.toISOString().slice(0,10)}</small></li>
            ))}
          </ul>
        </section>
      ))}
    </>
  )}
</PageLayout>
